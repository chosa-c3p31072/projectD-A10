package com.example.artrialapp; // あなたのプロジェクトのパッケージ名に合わせてください

import android.os.Bundle;
import android.widget.ArrayAdapter;
import android.widget.Button;
import android.widget.EditText;
import android.widget.Spinner;
import android.widget.TextView;
import android.widget.Toast;

import androidx.appcompat.app.AppCompatActivity;

import java.text.SimpleDateFormat;
import java.util.Date;
import java.util.Locale;

public class UserInfoActivity extends AppCompatActivity {

    private EditText editName, editNickname, editEmail, editHeadCircumference;
    private TextView textUserId, textRegistrationDate;
    private Spinner spinnerFaceShape;
    private Button buttonSave;

    // ダミーデータ (実際にはデータベースなどから取得)
    private String userName = "テスト ユーザー";
    private String userNickname = "てすたー";
    private String userId = "AR0000123456";
    private String userEmail = "test@example.com";
    private String userFaceShape = "丸顔"; // 例
    private String userHeadCircumference = "58.5"; // 例
    private Date registrationDate = new Date(); // 現在時刻をダミーとして設定

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_user_info);

        // 各Viewの参照を取得
        editName = findViewById(R.id.edit_name);
        editNickname = findViewById(R.id.edit_nickname);
        textUserId = findViewById(R.id.text_user_id);
        editEmail = findViewById(R.id.edit_email);
        spinnerFaceShape = findViewById(R.id.spinner_face_shape);
        editHeadCircumference = findViewById(R.id.edit_head_circumference);
        textRegistrationDate = findViewById(R.id.text_registration_date);
        buttonSave = findViewById(R.id.button_save);

        // 顔型スピナーの設定
        ArrayAdapter<CharSequence> adapter = ArrayAdapter.createFromResource(
                this,
                R.array.face_shapes_array, // res/values/strings.xml で定義
                android.R.layout.simple_spinner_item
        );
        adapter.setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item);
        spinnerFaceShape.setAdapter(adapter);

        // ダミーデータを表示
        displayUserData();

        // 保存ボタンのクリックリスナー
        buttonSave.setOnClickListener(v -> saveUserData());
    }

    private void displayUserData() {
        editName.setText(userName);
        editNickname.setText(userNickname);
        textUserId.setText(userId);
        editEmail.setText(userEmail);

        // スピナーの選択状態をセット
        ArrayAdapter<CharSequence> adapter = (ArrayAdapter<CharSequence>) spinnerFaceShape.getAdapter();
        if (userFaceShape != null) {
            int spinnerPosition = adapter.getPosition(userFaceShape);
            spinnerFaceShape.setSelection(spinnerPosition);
        }

        editHeadCircumference.setText(userHeadCircumference);

        // 登録日時をフォーマットして表示
        SimpleDateFormat sdf = new SimpleDateFormat("yyyy/MM/dd HH:mm", Locale.JAPAN);
        textRegistrationDate.setText(sdf.format(registrationDate));
    }

    private void saveUserData() {
        // ここで入力されたデータを取得し、保存処理を行います。
        // 実際にはSharedPreferences、SQLiteデータベース、またはサーバーAPIを通じて保存します。
        String newName = editName.getText().toString();
        String newNickname = editNickname.getText().toString();
        String newEmail = editEmail.getText().toString();
        String newFaceShape = spinnerFaceShape.getSelectedItem().toString();
        String newHeadCircumference = editHeadCircumference.getText().toString();

        // 例: 保存されたことをToastで表示
        Toast.makeText(this, "ユーザー情報が保存されました！", Toast.LENGTH_SHORT).show();

        // 実際にはここでデータ永続化の処理 (DB更新、APIコールなど) を記述します。
        // 例: user.setName(newName); user.save();
    }
}
